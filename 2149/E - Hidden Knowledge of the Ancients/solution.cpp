#include <bits/stdc++.h>using namespace std; #define int long long int#define endl '\n'#define all(x) x.begin(), x.end() void solve(){    int n, k, l, r;    cin >> n >> k >> l >> r;    int a[n];    for (int i = 0; i < n; i++)        cin >> a[i];     map<int, int> mp;    set<pair<int, int>> s;    int ans = 0;     for (int i = 0; i < n; i++)    {        int x = a[i];        if (mp.find(x) != mp.end())        {            s.erase({mp[x], x});        }        mp[x] = i;        s.insert({mp[x], x});        if (s.size() > k + 1)        {            s.erase(s.begin());        }         if (s.size() < k)            continue;        int lo, hi;         if (s.size() == k)        {            lo = i - s.begin()->first + 1;            hi = i + 1;        }        else        {            lo = i - next(s.begin())->first + 1;            hi = i - s.begin()->first;        }        lo = max(lo, l);        hi = min(hi, r);        if (lo <= hi)            ans += hi - lo + 1;    }    cout << ans << '\n';} int32_t main(){    ios_base::sync_with_stdio(0);    cin.tie(0);    int t = 1;    cin >> t;    while (t--)        solve();    return 0;}