#include <bits/stdc++.h>using namespace std; #define int long long#define all(x) x.begin(), x.end()int i, j, k, to, tot, n, ans, l[200001]; void solve(){    cin >> n; to = 0; tot = 0; ans = 0;    vector<map<int, int>> v(n);    map<int, int> mp;    for (i = 0; i < n; i++){        cin >> l[i]; k = l[i]; to += k;        while (k--) cin >> j, v[i][j]++, mp[j]++;    }    for (i = 0; i < n; i++) tot += l[i] * (n - 1);    for (i = 0; i < n; i++){        j = 0;        while (v[i][j] > 0)j++;        ans += j * (n - 1) * l[i];        for (k = 0; k < j; k++) if (v[i][k] == 1) ans += (k - j) * (n - 1);        k = j + 1;        while (v[i][k] > 0) k++;        ans += mp[j] * k;        ans += j * (to - l[i] - mp[j]);        ans += j * (tot - (to - l[i]) - l[i] * (n - 1));    }    cout << ans << '\n';} int32_t main(){    ios_base::sync_with_stdio(0);    cin.tie(0);     int t;    cin >> t;    while (t--)        solve();    return 0;}