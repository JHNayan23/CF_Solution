<h3><a href="https://codeforces.com/contest/2173/problem/E" target="_blank" rel="noopener noreferrer">Shiro's Mirror Duel</a></h3>

<div class="header"><div class="title">E. Shiro's Mirror Duel</div><div class="time-limit"><div class="property-title">time limit per test</div>3 seconds</div><div class="memory-limit"><div class="property-title">memory limit per test</div>256 megabytes</div><div class="input-file input-standard"><div class="property-title">input</div>standard input</div><div class="output-file output-standard"><div class="property-title">output</div>standard output</div></div><div><p>    </p><div class="epigraph"><div class="epigraph-text"><span class="tex-font-style-it">There's no such thing as luck in this world. The victor is decided before the game even starts.</span></div><div class="epigraph-source">— <span class="tex-font-style-it">No Game No Life</span></div></div><p><span class="tex-font-style-it">This is an interactive problem.</span> </p><p>One day, Sora and Shiro feel bored again, so they decide to settle it with a game.</p><p>At the beginning, Sora gives Shiro a permutation$$$^{\text{∗}}$$$ $$$p_1,p_2,\ldots,p_n$$$ of length $$$n$$$. In each operation, Shiro may select two distinct indices $$$x$$$ and $$$y$$$ ($$$1\le x\ne y\le n$$$). Then Sora flips a fair coin:</p><ul> <li> With probability $$$0.5$$$, Sora swaps $$$p_x$$$ and $$$p_y$$$; </li><li> With probability $$$0.5$$$, Sora swaps $$$p_{n-x+1}$$$ and $$$p_{n-y+1}$$$. </li></ul><p>After the operation, Sora replies with the actual pair of indices that were swapped, so that Shiro can update her local permutation accordingly. </p><p>Shiro's goal is to sort the permutation $$$p$$$ in ascending order by using at most $$$\lfloor 2.5n+800\rfloor$$$ operations. Help her!</p><div class="statement-footnote"><p>$$$^{\text{∗}}$$$A permutation of length $$$n$$$ is an array consisting of $$$n$$$ distinct integers from $$$1$$$ to $$$n$$$ in arbitrary order. For example, $$$[2,3,1,5,4]$$$ is a permutation, but $$$[1,2,2]$$$ is not a permutation ($$$2$$$ appears twice in the array), and $$$[1,3,4]$$$ is also not a permutation ($$$n=3$$$ but there is $$$4$$$ in the array). </p></div></div><div class="input-specification"><div class="section-title">Input</div><p>Each test contains multiple test cases. The first line contains the number of test cases $$$t$$$ ($$$1 \le t \le 100$$$). The description of the test cases follows. </p><p>The first line of each test case contains a single integer $$$n$$$ ($$$1\le n\le 4000$$$) — the length of $$$p$$$.</p><p>The second line contains $$$n$$$ integers $$$p_1,p_2,\ldots,p_n$$$ — the elements of $$$p$$$.</p><p>It is guaranteed that the sum of $$$n$$$ over all test cases does not exceed $$$2\cdot 10^4$$$. </p><p><span class="tex-font-style-bf">It is guaranteed that there are $$$50$$$ tests in this problem.</span></p></div><div><div class="section-title">Interaction</div><p>For each test case, you can use at most $$$\lfloor 2.5n+800\rfloor$$$ moves to sort the permutation $$$p$$$ in ascending order.</p><p>To make a move, you should print a new line in the following format:</p><ul> <li> $$$\mathtt{?}\; x\; y$$$ ($$$1 \le x \ne y \le n$$$) — the two indices that Shiro selects in this move. </li></ul><p>As a response to the move, you will receive two integers $$$u$$$ and $$$v$$$ — the actual pair of indices that Sora swapped. It is guaranteed that $$$(u, v)$$$ is randomly selected from $$$(x, y)$$$ and $$$(n-x+1, n-y+1)$$$ with equal probability.</p><p>To report that the permutation has been sorted in ascending order, you should print a new line with a single character $$$\mathtt{!}$$$. This does <span class="tex-font-style-bf">not</span> count as one of the $$$\lfloor 2.5n+800\rfloor$$$ moves. </p><p>After that, proceed to the next test case or terminate the program if it was the last test case.</p><p>After printing each query do not forget to output the end of line and flush$$$^{\text{∗}}$$$ the output. Otherwise, you will get <span class="tex-font-style-tt">Idleness limit exceeded</span> verdict.</p><p>If, at any interaction step, you read $$$-1$$$ instead of valid data, your solution must exit immediately. This means that your solution will receive <span class="tex-font-style-tt">Wrong answer</span> because of an invalid query or any other mistake. Failing to exit can result in an arbitrary verdict because your solution will continue to read from a closed stream. </p><p><span class="tex-font-style-bf">Hacks are disabled in this problem.</span></p><div class="statement-footnote"><p>$$$^{\text{∗}}$$$To flush, use: </p><ul> <li> <span class="tex-font-style-tt">fflush(stdout)</span> or <span class="tex-font-style-tt">cout.flush()</span> in C++; </li><li> <span class="tex-font-style-tt">sys.stdout.flush()</span> in Python; </li><li> see the documentation for other languages. </li></ul></div></div><div class="sample-tests"><div class="section-title">Example</div><div class="sample-test"><div class="input"><div class="title">Input<div title="Copy" data-clipboard-target="#id007212817462323222" id="id0046399657498441227" class="input-output-copier">Copy</div></div><pre id="id007212817462323222">2
5
5 1 3 4 2

1 5

2 1

2
1 2

</pre></div><div class="output"><div class="title">Output<div title="Copy" data-clipboard-target="#id008122999675671444" id="id0035900281503081755" class="input-output-copier">Copy</div></div><pre id="id008122999675671444">


? 1 5

? 4 5

!


!</pre></div></div></div><div class="note"><div class="section-title">Note</div><p>In the first test case, $$$n=5$$$ and the initial permutation is $$$[5,1,3,4,2]$$$. </p><ul> <li> We print <span class="tex-font-style-tt">? 1 5</span>. The judge replies <span class="tex-font-style-tt">1 5</span>, meaning positions $$$1$$$ and $$$5$$$ are swapped (no mirroring). The array becomes $$$[2,1,3,4,5]$$$. </li><li> We print <span class="tex-font-style-tt">? 4 5</span>. The judge replies <span class="tex-font-style-tt">2 1</span>, which is the mirror of $$${4,5}$$$ because with $$$n=5$$$ we have $$$n-4+1=2$$$ and $$$n-5+1=1$$$. Thus we must swap positions $$$2$$$ and $$$1$$$. The array becomes $$$[1,2,3,4,5]$$$. </li><li> The permutation is now sorted, so we print <span class="tex-font-style-tt">!</span>. The answer line does not count toward the operation limit. </li></ul><p>In the second test case, the given permutation is already increasing, so we just need to output <span class="tex-font-style-tt">!</span>.</p></div>