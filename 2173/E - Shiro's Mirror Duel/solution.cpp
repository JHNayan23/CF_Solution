#include <bits/stdc++.h>using namespace std; #define int long long int//#define endl '\n'#define all(x) x.begin(), x.end() int arr[4005];int idx[4005];   int ask(int x, int y) {    cout << "? " << x + 1 << " " << y + 1 << endl;    int u, v;    cin >> u >> v;    if (u == -1 || v == -1) return - 1;    u--, v--;    int A = arr[u], B = arr[v];    swap(arr[u], arr[v]);    idx[A] = v;    idx[B] = u;     return 1;} void solve() {    int n; cin >> n;    for (int i = 0; i < n; i++) cin >> arr[i];    for (int i = 0; i < n; i++) {        arr[i]--;                idx[arr[i]] = i;     }     for (int L = 0, R = n - 1; L < R; L++, R--) {        while (arr[L] != L || arr[R] != R) {            int pL = idx[L];            int pR = idx[R];            if (pL == R || pR == L) {                ask(L, R);                continue;            }            if (arr[L] != L) ask(pL, L);            else ask(pR, R);        }    }     cout << "!" << endl;} int32_t main(){    ios_base::sync_with_stdio(0);    cin.tie(0);    int t = 1;    cin >> t;    while (t--)        solve();    return 0;}